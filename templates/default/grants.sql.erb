# Give access from this IP

CREATE USER if not exists '<%= node['mysql']['user'] %>'@'localhost' identified by '<%= node['mysql']['password'] %>';
CREATE USER if not exists '<%= node['mysql']['user'] %>'@'127.0.0.1' identified by '<%= node['mysql']['password'] %>';

GRANT NDB_STORED_USER ON *.* to '<%= node['mysql']['user'] %>'@'localhost';
GRANT NDB_STORED_USER ON *.* to '<%= node['mysql']['user'] %>'@'127.0.0.1';

GRANT ALL PRIVILEGES ON *.* to '<%= node['mysql']['user'] %>'@'localhost';
GRANT ALL PRIVILEGES ON *.* to '<%= node['mysql']['user'] %>'@'127.0.0.1';

GRANT GRANT OPTION ON *.* to '<%= node['mysql']['user'] %>'@'localhost';
GRANT GRANT OPTION ON *.* to '<%= node['mysql']['user'] %>'@'127.0.0.1';

<% if @benchmark == "true" -%>

<% for mysqld in node['ndb']['mysqld']['private_ips'] -%>
CREATE USER if not exists '<%= node['bench']['user'] %>'@'<%= mysqld %>' identified by '<%= node['bench']['password'] %>';
GRANT ALL PRIVILEGES ON *.* to '<%= node['bench']['user'] %>'@'<%= mysqld %>';
<% end -%>

<% for mgmd in node['ndb']['mgmd']['private_ips'] -%>
CREATE USER if not exists '<%= node['bench']['user'] %>'@'<%= mysqld %>' identified by '<%= node['bench']['password'] %>';
GRANT ALL PRIVILEGES ON *.* to '<%= node['bench']['user'] %>'@'<%= mgmd %>';
<% end -%>

<% end -%>